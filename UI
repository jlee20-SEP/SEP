classdef Test1ARD < matlab.apps.AppBase

    % Properties that correspond to app components
    properties (Access = public)
        UIFigure                    matlab.ui.Figure
        OutputAreaTextArea          matlab.ui.control.TextArea
        OutputAreaTextAreaLabel     matlab.ui.control.Label
        SendButton                  matlab.ui.control.Button
        MessageFieldEditField       matlab.ui.control.EditField
        MessageFieldEditFieldLabel  matlab.ui.control.Label
        ConnectButton               matlab.ui.control.Button
    end

    
    properties (Access = private)
        a % Arduino serial object
    end
    
    methods (Access = private)
        
        function onArduinoData(app, src)
    try
        data = readline(src);
        app.OutputAreaTextArea.Value = data;
    catch
        % ignore bad serial data
   
    end
     end
   end
    
    

    % Callbacks that handle component events
    methods (Access = private)

        % Button pushed function: ConnectButton
        function ConnectButtonPushed(app, event)
         try
                % ---------- Assign to the new private property ----------
                app.a = serialport("COM9", 9600);   
                configureTerminator(app.a,"LF");

                % Asynchronous callback for incoming data
                configureCallback(app.a, "terminator", @(src,evt) onArduinoData(app,src));

                app.OutputAreaTextArea.Value = "Connected!";
            catch ME
                app.OutputAreaTextArea.Value = "Connection Failed: " + ME.message;
         end 
        end

        % Button pushed function: SendButton
        function SendButtonPushed(app, event)
  % ---------- Use correct component name ----------
            msg = app.MessageFieldEditField.Value;   

            try
                writeline(app.a, msg);
                app.OutputAreaTextArea.Value = "Sent: " + msg;
            catch ME
                app.OutputAreaTextArea.Value = "Send failed: " + ME.message;  % typo fixed
            end
        end
    end

    % Component initialization
    methods (Access = private)

        % Create UIFigure and components
        function createComponents(app)

            % Create UIFigure and hide until all components are created
            app.UIFigure = uifigure('Visible', 'off');
            app.UIFigure.Position = [100 100 640 480];
            app.UIFigure.Name = 'MATLAB App';

            % Create ConnectButton
            app.ConnectButton = uibutton(app.UIFigure, 'push');
            app.ConnectButton.ButtonPushedFcn = createCallbackFcn(app, @ConnectButtonPushed, true);
            app.ConnectButton.Position = [249 346 100 22];
            app.ConnectButton.Text = 'Connect';

            % Create MessageFieldEditFieldLabel
            app.MessageFieldEditFieldLabel = uilabel(app.UIFigure);
            app.MessageFieldEditFieldLabel.HorizontalAlignment = 'right';
            app.MessageFieldEditFieldLabel.Position = [189 304 80 22];
            app.MessageFieldEditFieldLabel.Text = 'MessageField';

            % Create MessageFieldEditField
            app.MessageFieldEditField = uieditfield(app.UIFigure, 'text');
            app.MessageFieldEditField.Position = [284 304 100 22];

            % Create SendButton
            app.SendButton = uibutton(app.UIFigure, 'push');
            app.SendButton.ButtonPushedFcn = createCallbackFcn(app, @SendButtonPushed, true);
            app.SendButton.Position = [249 258 100 22];
            app.SendButton.Text = 'Send';

            % Create OutputAreaTextAreaLabel
            app.OutputAreaTextAreaLabel = uilabel(app.UIFigure);
            app.OutputAreaTextAreaLabel.HorizontalAlignment = 'right';
            app.OutputAreaTextAreaLabel.Position = [166 203 66 22];
            app.OutputAreaTextAreaLabel.Text = 'OutputArea';

            % Create OutputAreaTextArea
            app.OutputAreaTextArea = uitextarea(app.UIFigure);
            app.OutputAreaTextArea.Position = [247 167 150 60];

            % Show the figure after all components are created
            app.UIFigure.Visible = 'on';
        end
    end

    % App creation and deletion
    methods (Access = public)

        % Construct app
        function app = Test1ARD

            % Create UIFigure and components
            createComponents(app)

            % Register the app with App Designer
            registerApp(app, app.UIFigure)

            if nargout == 0
                clear app
            end
        end

        % Code that executes before app deletion
        function delete(app)

            % Delete UIFigure when app is deleted
            delete(app.UIFigure)
        end
    end
end
